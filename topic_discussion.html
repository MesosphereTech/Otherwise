<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯é¢˜è®¨è®º - Otherwiseå¦åˆ™</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="index.html">Otherwise<span style="margin-left: 0.5rem; font-size: 0.875rem; color: var(--color-text-secondary);">å¦åˆ™</span></a>
                </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="projects.html" class="nav-link">è¯é¢˜</a>
                <a href="profile.html" class="nav-link">ä¸ªäººä¸­å¿ƒ</a>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 2rem;">
        <div class="grid grid-cols-3" style="gap: 2rem; align-items: start;">
            <!-- å·¦ä¾§ï¼šè¯é¢˜ä¿¡æ¯ -->
                                    <div>
                <!-- è¯é¢˜åŸºæœ¬ä¿¡æ¯ -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div style="margin-bottom: 1rem;">
                        <span id="topicCategory" style="padding: 0.25rem 0.5rem; background-color: var(--color-background-tertiary); border-radius: var(--radius-sm); font-size: 0.75rem;">æŠ€æœ¯åˆ›æ–°</span>
                                    </div>
                    <h1 id="topicTitle" style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem;">AIé©±åŠ¨çš„æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿ</h1>
                    
                    <!-- è¯é¢˜å…ƒä¿¡æ¯ -->
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span>ğŸ‘¤</span>
                            <span id="topicAuthor">å¼ ç ”ç©¶å‘˜</span>
                            <span style="padding: 0.125rem 0.25rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.625rem;">åŒ¿å</span>
                            </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span>ğŸ•’</span>
                            <span id="topicTime">2å°æ—¶å‰</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span>ğŸ”¥</span>
                            <span id="topicHeat">çƒ­åº¦ 127</span>
                        </div>
                    </div>

                    <!-- è¯é¢˜æ ‡ç­¾ -->
                    <div id="topicTags" style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-bottom: 1rem;">
                        <span style="padding: 0.25rem 0.5rem; background-color: var(--color-primary); color: var(--color-secondary); border-radius: var(--radius-sm); font-size: 0.75rem;">AI</span>
                        <span style="padding: 0.25rem 0.5rem; background-color: var(--color-primary); color: var(--color-secondary); border-radius: var(--radius-sm); font-size: 0.75rem;">åŒ»ç–—</span>
                        <span style="padding: 0.25rem 0.5rem; background-color: var(--color-primary); color: var(--color-secondary); border-radius: var(--radius-sm); font-size: 0.75rem;">æ·±åº¦å­¦ä¹ </span>
                    </div>

                    <!-- è¯é¢˜æ“ä½œ -->
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="toggleLike()" class="btn btn-ghost btn-sm" id="likeBtn">
                            <span>ğŸ‘</span> <span id="likeCount">23</span>
                        </button>
                        <button onclick="toggleFollow()" class="btn btn-ghost btn-sm" id="followBtn">
                            <span>ğŸ“Œ</span> å…³æ³¨
                        </button>
                        <button onclick="shareTopic()" class="btn btn-ghost btn-sm">
                            <span>ğŸ“¤</span> åˆ†äº«
                        </button>
                        </div>
                        </div>

                <!-- ç³»ç»Ÿåˆ†è§£ç»´åº¦ -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ” è®¨è®ºç»´åº¦</h3>
                    <div id="topicDimensions" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                        <button class="dimension-btn active" data-dimension="all">å…¨éƒ¨</button>
                        <button class="dimension-btn" data-dimension="resources">ğŸ“‹ èµ„æºéœ€æ±‚</button>
                        <button class="dimension-btn" data-dimension="theory">âš™ï¸ æŠ€æœ¯åŸç†</button>
                        <button class="dimension-btn" data-dimension="implementation">ğŸ”§ æŠ€æœ¯å®æ–½</button>
                        <button class="dimension-btn" data-dimension="software">ğŸ’» è½¯ä»¶</button>
                        <button class="dimension-btn" data-dimension="hardware">ğŸ”© ç¡¬ä»¶</button>
                        <button class="dimension-btn" data-dimension="market">ğŸ“Š å¸‚åœº</button>
                        <button class="dimension-btn" data-dimension="finance">ğŸ’° è´¢åŠ¡</button>
                        <button class="dimension-btn" data-dimension="funding">ğŸ¦ èèµ„</button>
                    </div>
                </div>

                <!-- è®¨è®ºç»Ÿè®¡ -->
                <div class="card">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ“Š è®¨è®ºç»Ÿè®¡</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.875rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>å¦å®šæ„è§</span>
                            <span style="color: #ff4444; font-weight: 500;" id="negationCount">34</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>è‚¯å®šæ„è§</span>
                            <span style="color: #00aa44; font-weight: 500;" id="affirmationCount">12</span>
                    </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>å‚ä¸ç”¨æˆ·</span>
                            <span id="participantCount">28</span>
                            </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>ä¸Šå¸è‚¯å®š</span>
                            <span style="color: #ffa500; font-weight: 500;" id="godAffirmationCount">2</span>
                        </div>
                    </div>
                            </div>
                        </div>

            <!-- ä¸­é—´ï¼šä¸»è¦å†…å®¹ -->
                                    <div>
                <!-- è¯é¢˜è¯¦ç»†æè¿° -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ“„ é¡¹ç›®æè¿°</h3>
                    <div id="topicDescription" style="font-size: 0.875rem; color: var(--color-text-secondary); line-height: 1.6; white-space: pre-line;">é¡¹ç›®èƒŒæ™¯ï¼šä¼ ç»ŸåŒ»ç–—è¯Šæ–­å­˜åœ¨æ•ˆç‡ä½ã€è¯¯è¯Šç‡é«˜çš„é—®é¢˜ã€‚

æŠ€æœ¯æ–¹æ¡ˆï¼šåŸºäºæ·±åº¦å­¦ä¹ çš„åŒ»ç–—å½±åƒè¯†åˆ«ç³»ç»Ÿï¼Œç»“åˆå¤šæ¨¡æ€æ•°æ®èåˆæŠ€æœ¯ã€‚

ç°çŠ¶ä¸æŒ‘æˆ˜ï¼š
1. å·²å®Œæˆç®—æ³•åŸå‹å¼€å‘
2. éœ€è¦å¤§é‡åŒ»ç–—æ•°æ®è¿›è¡Œè®­ç»ƒ
3. é¢ä¸´æ•°æ®éšç§å’Œç›‘ç®¡å®¡æ‰¹é—®é¢˜

æœŸæœ›åˆä½œï¼šå¯»æ±‚åŒ»é™¢åˆä½œä¼™ä¼´ã€æ•°æ®ç§‘å­¦å®¶å’ŒæŠ•èµ„æ–¹</div>
                                    </div>

                <!-- å¦å®šæ„è§åŒºåŸŸï¼ˆä¼˜å…ˆå±•ç¤ºï¼‰ -->
                <div class="card" style="margin-bottom: 1.5rem; border-left: 4px solid #ff4444;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; color: #ff4444;">âš¡ å¦å®šæ„è§ (ä¼˜å…ˆå±•ç¤º)</h3>
                        <button onclick="postNegation()" class="btn btn-primary btn-sm">
                            å‘è¡¨å¦å®šæ„è§
                        </button>
                                </div>

                    <!-- å¦å®šæ„è§åˆ—è¡¨ -->
                    <div id="negationList" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- å¦å®šæ„è§å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                        </div>

                <!-- è‚¯å®šæ„è§åŒºåŸŸ -->
                <div class="card" style="margin-bottom: 1.5rem; border-left: 4px solid #00aa44;" id="affirmationSection" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; color: #00aa44;">âœ… è‚¯å®šæ„è§</h3>
                        <button onclick="postAffirmation()" class="btn btn-secondary btn-sm" id="affirmBtn" disabled>
                            å‘è¡¨è‚¯å®šæ„è§
                        </button>
                                    </div>
                    <div style="font-size: 0.875rem; color: var(--color-text-muted); margin-bottom: 1rem;">
                        ğŸ’¡ è‚¯å®šåŠŸèƒ½å°†åœ¨æœ‰å¦å®šæ„è§åå¼€æ”¾
                                </div>

                    <!-- è‚¯å®šæ„è§åˆ—è¡¨ -->
                    <div id="affirmationList" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- è‚¯å®šæ„è§å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                            </div>

                <!-- æ™®é€šè®¨è®ºåŒºåŸŸ -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 600;">ğŸ’¬ è®¨è®º</h3>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;">
                                <input type="checkbox" id="anonymousMode" checked>
                                åŒ¿åæ¨¡å¼
                            </label>
                            <button onclick="postComment()" class="btn btn-secondary btn-sm">
                                å‘è¡¨è®¨è®º
                            </button>
                        </div>
                    </div>

                    <!-- è®¨è®ºå›å¤åˆ—è¡¨ -->
                    <div id="discussionList" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- è®¨è®ºå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šç›¸å…³ä¿¡æ¯ -->
            <div>
                <!-- å‘å¸ƒè€…ä¿¡æ¯ -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ‘¤ å‘å¸ƒè€…ä¿¡æ¯</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.875rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--color-background-tertiary); display: flex; align-items: center; justify-content: center;">ğŸ‘¤</div>
                            <div>
                                <div style="font-weight: 500;">åŒ¿åç”¨æˆ·</div>
                                <div style="color: var(--color-text-secondary); font-size: 0.75rem;">é«˜ç­‰é™¢æ ¡ç ”ç©¶è€…</div>
                        </div>
                        </div>
                        <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.75rem; color: var(--color-text-muted);">
                            ğŸ”’ ä¸ºä¿æŠ¤éšç§ï¼Œå‘å¸ƒè€…é€‰æ‹©åŒ¿åæ¨¡å¼
                        </div>
                    </div>
                </div>

                <!-- æ´»è·ƒå‚ä¸è€… -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸŒŸ æ´»è·ƒå‚ä¸è€…</h3>
                    <div id="activeParticipants" style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <!-- æ´»è·ƒå‚ä¸è€…åˆ—è¡¨ -->
                        </div>
                        </div>

                <!-- ç›¸å…³è¯é¢˜ -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ”— ç›¸å…³è¯é¢˜</h3>
                    <div id="relatedTopics" style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <!-- ç›¸å…³è¯é¢˜åˆ—è¡¨ -->
                    </div>
                </div>

                <!-- æ™ºèƒ½å»ºè®® -->
                <div class="card">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ¤– æ™ºèƒ½å»ºè®®</h3>
                    <div style="font-size: 0.875rem; color: var(--color-text-secondary); line-height: 1.5;">
                        <div style="margin-bottom: 0.5rem;">ğŸ’¡ å»ºè®®å…³æ³¨æŠ€æœ¯å¯è¡Œæ€§é—®é¢˜</div>
                        <div style="margin-bottom: 0.5rem;">ğŸ’¡ å¯å‚è€ƒç±»ä¼¼é¡¹ç›®çš„ç»éªŒ</div>
                        <div>ğŸ’¡ å»ºè®®å¯»æ±‚åŒ»ç–—è¡Œä¸šä¸“å®¶æ„è§</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å‘è¡¨å¦å®šæ„è§æ¨¡æ€æ¡† -->
    <div id="negationModal" style="display: none; position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 50; padding: 1rem; overflow-y: auto;">
        <div style="position: relative; top: 5%; margin: 0 auto; max-width: 600px;">
            <div class="card" style="padding: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.25rem; font-weight: 600; color: #ff4444;">âš¡ å‘è¡¨å¦å®šæ„è§</h3>
                    <button onclick="closeNegationModal()" style="background: none; border: none; color: var(--color-text-muted); cursor: pointer; font-size: 1.25rem;">âœ•</button>
                </div>
                
                <!-- é€‰æ‹©ç°æœ‰å¦å®šæ„è§ -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; font-weight: 500; margin-bottom: 0.75rem;">é€‰æ‹©å·²æœ‰å¦å®šæ„è§</h4>
                    <div id="existingNegations" style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 200px; overflow-y: auto; border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: 0.75rem;">
                        <!-- ç°æœ‰å¦å®šæ„è§åº“ -->
                    </div>
                </div>

                <!-- æˆ–è€…åˆ›å»ºæ–°çš„å¦å®šæ„è§ -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; font-weight: 500; margin-bottom: 0.75rem;">æˆ–è€…åˆ›å»ºæ–°æ„è§ (æœ€å¤š50å­—)</h4>
                    <textarea id="newNegationText" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--radius-md); font-size: 0.875rem; resize: vertical;" rows="3" maxlength="50" placeholder="è¯·ç®€æ´æ˜ç¡®åœ°è¡¨è¾¾ä½ çš„å¦å®šè§‚ç‚¹..."></textarea>
                    <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">
                        <span id="negationCharCount">0/50</span> - å¼•ç”¨ä»–äººæ„è§ä¸å å­—æ•°
                    </div>
                </div>

                <!-- å¼•ç”¨å…¶ä»–å¦å®šæ„è§ -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; font-weight: 500; margin-bottom: 0.75rem;">å¼•ç”¨å…¶ä»–æ„è§ (ä¸å å­—æ•°)</h4>
                    <div id="referenceableNegations" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <!-- å¯å¼•ç”¨çš„å¦å®šæ„è§ -->
                    </div>
                </div>

                <!-- é€‰æ‹©ç»´åº¦ -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; font-weight: 500; margin-bottom: 0.75rem;">é’ˆå¯¹ç»´åº¦</h4>
                    <select id="negationDimension" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--radius-md);">
                        <option value="general">æ•´ä½“é¡¹ç›®</option>
                        <option value="resources">é¡¹ç›®èµ„æºéœ€æ±‚</option>
                        <option value="theory">æŠ€æœ¯åŸç†</option>
                        <option value="implementation">æŠ€æœ¯å®æ–½</option>
                        <option value="software">è½¯ä»¶</option>
                        <option value="hardware">ç¡¬ä»¶</option>
                        <option value="market">å¸‚åœº</option>
                        <option value="finance">è´¢åŠ¡</option>
                        <option value="funding">èèµ„</option>
                    </select>
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button onclick="closeNegationModal()" class="btn btn-ghost">å–æ¶ˆ</button>
                    <button onclick="submitNegation()" class="btn btn-primary" style="flex: 1;">å‘è¡¨å¦å®šæ„è§</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="navigation.js"></script>
    <script src="main.js"></script>

    <script>
        let currentTopic = null;
        let negations = [];
        let affirmations = [];
        let discussions = [];
        let selectedNegationRefs = [];
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadTopicData();
            setupDimensionFilters();
            setupCharacterCount();
            initializeNegationLibrary();
            renderContent();
        });
        
        // åŠ è½½è¯é¢˜æ•°æ®
        function loadTopicData() {
            const urlParams = new URLSearchParams(window.location.search);
            const topicId = urlParams.get('id');
            
            // ä»localStorageè·å–è¯é¢˜æ•°æ®
            const topics = JSON.parse(localStorage.getItem('topics') || '[]');
            currentTopic = topics.find(t => t.id == topicId);
            
            if (!currentTopic) {
                // ä½¿ç”¨é»˜è®¤æ•°æ®
                currentTopic = {
                    id: topicId || '1',
                    title: 'AIé©±åŠ¨çš„æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿ',
                    category: 'tech',
                    description: 'é¡¹ç›®èƒŒæ™¯ï¼šä¼ ç»ŸåŒ»ç–—è¯Šæ–­å­˜åœ¨æ•ˆç‡ä½ã€è¯¯è¯Šç‡é«˜çš„é—®é¢˜ã€‚\n\næŠ€æœ¯æ–¹æ¡ˆï¼šåŸºäºæ·±åº¦å­¦ä¹ çš„åŒ»ç–—å½±åƒè¯†åˆ«ç³»ç»Ÿï¼Œç»“åˆå¤šæ¨¡æ€æ•°æ®èåˆæŠ€æœ¯ã€‚\n\nç°çŠ¶ä¸æŒ‘æˆ˜ï¼š\n1. å·²å®Œæˆç®—æ³•åŸå‹å¼€å‘\n2. éœ€è¦å¤§é‡åŒ»ç–—æ•°æ®è¿›è¡Œè®­ç»ƒ\n3. é¢ä¸´æ•°æ®éšç§å’Œç›‘ç®¡å®¡æ‰¹é—®é¢˜\n\næœŸæœ›åˆä½œï¼šå¯»æ±‚åŒ»é™¢åˆä½œä¼™ä¼´ã€æ•°æ®ç§‘å­¦å®¶å’ŒæŠ•èµ„æ–¹',
                    tags: ['AI', 'åŒ»ç–—', 'æ·±åº¦å­¦ä¹ ', 'è¯Šæ–­ç³»ç»Ÿ'],
                    anonymous: true,
                    timestamp: new Date().toISOString()
                };
            }
            
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            document.getElementById('topicTitle').textContent = currentTopic.title;
            document.getElementById('topicDescription').textContent = currentTopic.description;
            
            // æ›´æ–°æ ‡ç­¾
            const tagsContainer = document.getElementById('topicTags');
            tagsContainer.innerHTML = currentTopic.tags.map(tag => 
                `<span style="padding: 0.25rem 0.5rem; background-color: var(--color-primary); color: var(--color-secondary); border-radius: var(--radius-sm); font-size: 0.75rem;">${tag}</span>`
            ).join('');
            
            // åŠ è½½ç›¸å…³æ•°æ®
            loadTopicInteractions();
        }
        
        // åŠ è½½è¯é¢˜äº’åŠ¨æ•°æ®
        function loadTopicInteractions() {
            const topicId = currentTopic.id;
            
            // ä»localStorageåŠ è½½æ•°æ®
            negations = JSON.parse(localStorage.getItem(`negations_${topicId}`) || '[]');
            affirmations = JSON.parse(localStorage.getItem(`affirmations_${topicId}`) || '[]');
            discussions = JSON.parse(localStorage.getItem(`discussions_${topicId}`) || '[]');
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            document.getElementById('negationCount').textContent = negations.length;
            document.getElementById('affirmationCount').textContent = affirmations.length;
            document.getElementById('participantCount').textContent = 
                new Set([...negations, ...affirmations, ...discussions].map(item => item.author)).size;
            document.getElementById('godAffirmationCount').textContent = 
                affirmations.filter(a => a.isGod).length;
            
            // å¯ç”¨è‚¯å®šåŠŸèƒ½ï¼ˆå¦‚æœæœ‰å¦å®šæ„è§ï¼‰
            if (negations.length > 0) {
                document.getElementById('affirmationSection').style.display = 'block';
                document.getElementById('affirmBtn').disabled = false;
                document.querySelector('#affirmationSection .message').style.display = 'none';
            }
        }
        
        // åˆå§‹åŒ–å¦å®šæ„è§åº“
        function initializeNegationLibrary() {
            const library = [
                "æŠ€æœ¯æ–¹æ¡ˆä¸å¤Ÿæˆç†Ÿ",
                "å¸‚åœºéœ€æ±‚å­˜ç–‘",
                "æˆæœ¬è¿‡é«˜æ— æ³•å•†ä¸šåŒ–",
                "ç¼ºä¹å…³é”®æŠ€æœ¯äººæ‰",
                "æ•°æ®å®‰å…¨é£é™©å¤ªå¤§",
                "ç›‘ç®¡å®¡æ‰¹å›°éš¾",
                "ç«äº‰å¯¹æ‰‹æŠ€æœ¯æ›´å…ˆè¿›",
                "å•†ä¸šæ¨¡å¼ä¸æ¸…æ™°",
                "èµ„é‡‘éœ€æ±‚è¿‡å¤§",
                "æ—¶é—´çª—å£å·²é”™è¿‡"
            ];
            
            localStorage.setItem('negationLibrary', JSON.stringify(library));
        }
        
        // æ¸²æŸ“å†…å®¹
        function renderContent() {
            renderNegations();
            renderAffirmations();
            renderDiscussions();
            renderActiveParticipants();
            renderRelatedTopics();
        }
        
        // æ¸²æŸ“å¦å®šæ„è§
        function renderNegations() {
            const container = document.getElementById('negationList');
            if (negations.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem 0; color: var(--color-text-muted);">æš‚æ— å¦å®šæ„è§ï¼Œæˆä¸ºç¬¬ä¸€ä¸ªæå‡ºå¦å®šè§‚ç‚¹çš„äºº</div>';
                return;
            }
            
            container.innerHTML = negations.map(negation => `
                <div style="border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: 1rem;">
                    <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 0.75rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; flex: 1;">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background-color: var(--color-background-tertiary); display: flex; align-items: center; justify-content: center; font-size: 0.875rem;">
                                ${negation.isGod ? 'ğŸ‘‘' : (negation.anonymous ? 'ğŸ‘¤' : 'ğŸ‘¤')}
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; font-weight: 500;">
                                    ${negation.anonymous ? 'åŒ¿åç”¨æˆ·' : negation.author}
                                    ${negation.isGod ? '<span style="color: #ffa500; font-size: 0.75rem; margin-left: 0.25rem;">ä¸Šå¸</span>' : ''}
                                </div>
                                <div style="font-size: 0.75rem; color: var(--color-text-secondary);">
                                    ${negation.dimension} Â· ${formatTime(negation.timestamp)}
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.25rem;">
                            <button onclick="likeNegation('${negation.id}')" class="btn btn-ghost" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                ğŸ‘ ${negation.likes || 0}
                            </button>
                            <button onclick="replyToNegation('${negation.id}')" class="btn btn-ghost" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                å¦å®šæ­¤æ„è§
                            </button>
                        </div>
                    </div>
                    <div style="font-size: 0.875rem; line-height: 1.5; margin-bottom: 0.75rem;">
                        ${negation.content}
                    </div>
                    ${negation.references ? `
                    <div style="font-size: 0.75rem; color: var(--color-text-muted); padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm);">
                        å¼•ç”¨: ${negation.references.join(', ')}
                    </div>
                    ` : ''}
                    ${negation.replies ? renderNegationReplies(negation.replies) : ''}
                </div>
            `).join('');
        }
        
        // æ¸²æŸ“å¦å®šå›å¤
        function renderNegationReplies(replies) {
            if (!replies || replies.length === 0) return '';
            
            return `
                <div style="margin-top: 0.75rem; padding-left: 1rem; border-left: 2px solid var(--color-border);">
                    ${replies.map(reply => `
                        <div style="padding: 0.5rem 0; border-bottom: 1px solid var(--color-border-light);">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span style="font-size: 0.75rem; font-weight: 500;">${reply.anonymous ? 'åŒ¿åç”¨æˆ·' : reply.author}</span>
                                <span style="font-size: 0.75rem; color: var(--color-text-secondary);">${formatTime(reply.timestamp)}</span>
                            </div>
                            <div style="font-size: 0.875rem;">${reply.content}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // è®¾ç½®ç»´åº¦ç­›é€‰
        function setupDimensionFilters() {
            document.querySelectorAll('.dimension-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.dimension-btn').forEach(b => b.classList.remove('active'));
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    this.classList.add('active');
                    
                    // ç­›é€‰å†…å®¹
                    const dimension = this.dataset.dimension;
                    filterByDimension(dimension);
                });
            });
        }
        
        // å‘è¡¨å¦å®šæ„è§
        function postNegation() {
            document.getElementById('negationModal').style.display = 'block';
            loadExistingNegations();
            loadReferenceableNegations();
        }
        
        // åŠ è½½ç°æœ‰å¦å®šæ„è§
        function loadExistingNegations() {
            const library = JSON.parse(localStorage.getItem('negationLibrary') || '[]');
            const container = document.getElementById('existingNegations');
            
            container.innerHTML = library.map(negation => `
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: var(--radius-sm); cursor: pointer; hover:background-color: var(--color-hover);">
                    <input type="radio" name="existingNegation" value="${negation}" style="width: auto;">
                    <span style="font-size: 0.875rem;">${negation}</span>
                </label>
            `).join('');
        }
        
        // æäº¤å¦å®šæ„è§
        function submitNegation() {
            const selectedExisting = document.querySelector('input[name="existingNegation"]:checked');
            const newContent = document.getElementById('newNegationText').value.trim();
            const dimension = document.getElementById('negationDimension').value;
            
            let content = '';
            if (selectedExisting) {
                content = selectedExisting.value;
            } else if (newContent) {
                content = newContent;
                // æ·»åŠ åˆ°å¦å®šæ„è§åº“
                const library = JSON.parse(localStorage.getItem('negationLibrary') || '[]');
                if (!library.includes(newContent)) {
                    library.push(newContent);
                    localStorage.setItem('negationLibrary', JSON.stringify(library));
                }
            } else {
                alert('è¯·é€‰æ‹©ç°æœ‰æ„è§æˆ–è¾“å…¥æ–°æ„è§');
                return;
            }
            
            const negation = {
                id: Date.now().toString(),
                content: content,
                dimension: dimension,
                author: 'å½“å‰ç”¨æˆ·',
                anonymous: document.getElementById('anonymousMode').checked,
                timestamp: new Date().toISOString(),
                references: selectedNegationRefs,
                likes: 0,
                replies: []
            };
            
            negations.unshift(negation);
            localStorage.setItem(`negations_${currentTopic.id}`, JSON.stringify(negations));
            
            closeNegationModal();
            loadTopicInteractions();
            renderContent();
        }
        
        // å…³é—­å¦å®šæ„è§æ¨¡æ€æ¡†
        function closeNegationModal() {
            document.getElementById('negationModal').style.display = 'none';
            document.getElementById('newNegationText').value = '';
            selectedNegationRefs = [];
        }
        
        // å­—ç¬¦è®¡æ•°
        function setupCharacterCount() {
            const textarea = document.getElementById('newNegationText');
            const counter = document.getElementById('negationCharCount');
            
            textarea.addEventListener('input', function() {
                const count = this.value.length;
                counter.textContent = `${count}/50`;
                
                if (count > 40) {
                    counter.style.color = '#ff4444';
                } else {
                    counter.style.color = 'var(--color-text-muted)';
                }
            });
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}å°æ—¶å‰`;
            return `${Math.floor(diff / 86400000)}å¤©å‰`;
        }
        
        // å…¶ä»–åŠŸèƒ½å‡½æ•°
        function toggleLike() {
            const btn = document.getElementById('likeBtn');
            const count = document.getElementById('likeCount');
            const current = parseInt(count.textContent);
            
            if (btn.classList.contains('liked')) {
                btn.classList.remove('liked');
                count.textContent = current - 1;
            } else {
                btn.classList.add('liked');
                count.textContent = current + 1;
            }
        }
        
        function toggleFollow() {
            const btn = document.getElementById('followBtn');
            if (btn.textContent.includes('å…³æ³¨')) {
                btn.innerHTML = '<span>ğŸ“Œ</span> å·²å…³æ³¨';
                btn.style.backgroundColor = 'var(--color-primary)';
                btn.style.color = 'var(--color-secondary)';
            } else {
                btn.innerHTML = '<span>ğŸ“Œ</span> å…³æ³¨';
                btn.style.backgroundColor = '';
                btn.style.color = '';
            }
        }
        
        function shareTopic() {
            if (navigator.share) {
                navigator.share({
                    title: currentTopic.title,
                    text: currentTopic.description.substring(0, 100) + '...',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }
        
        // æ¸²æŸ“å…¶ä»–å†…å®¹çš„å ä½å‡½æ•°
        function renderAffirmations() {
            const container = document.getElementById('affirmationList');
            if (affirmations.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem 0; color: var(--color-text-muted); font-size: 0.875rem;">æš‚æ— è‚¯å®šæ„è§</div>';
            }
        }
        
        function renderDiscussions() {
            const container = document.getElementById('discussionList');
            if (discussions.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem 0; color: var(--color-text-muted); font-size: 0.875rem;">æš‚æ— è®¨è®ºï¼Œå¼€å§‹ç¬¬ä¸€ä¸ªè®¨è®ºå§</div>';
            }
        }
        
        function renderActiveParticipants() {
            const container = document.getElementById('activeParticipants');
            container.innerHTML = '<div style="font-size: 0.875rem; color: var(--color-text-muted);">æš‚æ— æ´»è·ƒå‚ä¸è€…</div>';
        }
        
        function renderRelatedTopics() {
            const container = document.getElementById('relatedTopics');
            container.innerHTML = '<div style="font-size: 0.875rem; color: var(--color-text-muted);">æš‚æ— ç›¸å…³è¯é¢˜</div>';
        }
    </script>
    
    <style>
        .dimension-btn {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            background-color: var(--color-background);
            color: var(--color-text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .dimension-btn:hover {
            background-color: var(--color-hover);
            border-color: var(--color-text-secondary);
        }
        
        .dimension-btn.active {
            background-color: var(--color-primary);
            color: var(--color-secondary);
            border-color: var(--color-primary);
        }
        
        .btn.liked {
            background-color: var(--color-primary);
            color: var(--color-secondary);
        }
    </style>
</body>
</html>




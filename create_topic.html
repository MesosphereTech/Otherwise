<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发布话题 - Otherwise否则</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="index.html">Otherwise<span style="margin-left: 0.5rem; font-size: 0.875rem; color: var(--color-text-secondary);">否则</span></a>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">首页</a>
                <a href="projects.html" class="nav-link">项目话题</a>
                <a href="create_topic.html" class="nav-link active">发布话题</a>
                
                <!-- 个人中心下拉菜单 -->
                <div class="nav-dropdown" style="position: relative;">
                    <button id="profileDropdownBtn" class="nav-link" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                        <span>个人中心</span>
                        <span style="font-size: 0.75rem;">▼</span>
                    </button>
                    <div id="profileDropdownMenu" class="dropdown-menu" style="display: none; position: absolute; top: 100%; right: 0; background: var(--color-background); border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-lg); min-width: 200px; z-index: 50;">
                        <a href="profile.html" class="dropdown-item" style="display: block; padding: 0.75rem 1rem; color: var(--color-text-primary); text-decoration: none; border-bottom: 1px solid var(--color-border);">
                            <span style="margin-right: 0.5rem;">👤</span>我的资料
                        </a>
                        <a href="projects.html" class="dropdown-item" style="display: block; padding: 0.75rem 1rem; color: var(--color-text-primary); text-decoration: none; border-bottom: 1px solid var(--color-border);">
                            <span style="margin-right: 0.5rem;">📋</span>我的项目
                        </a>
                        <a href="bounty_system.html" class="dropdown-item" style="display: block; padding: 0.75rem 1rem; color: var(--color-text-primary); text-decoration: none; border-bottom: 1px solid var(--color-border);">
                            <span style="margin-right: 0.5rem;">💰</span>悬赏令
                        </a>
                        <button onclick="window.logout()" class="dropdown-item" style="display: block; width: 100%; text-align: left; padding: 0.75rem 1rem; color: var(--color-text-secondary); background: none; border: none; cursor: pointer;">
                            <span style="margin-right: 0.5rem;">🚪</span>退出登录
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 2rem;">
        <div class="grid grid-cols-3" style="gap: 2rem; align-items: start;">
            <!-- 左侧：发布指南 -->
            <div>
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">📋 发布指南</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.875rem; color: var(--color-text-secondary);">
                        <div>1. 清晰描述你的项目或问题</div>
                        <div>2. 选择合适的分类和标签</div>
                        <div>3. 预期会收到"否定"意见</div>
                        <div>4. 保持开放心态，接受建设性批评</div>
                        <div>5. 通过否定-改进循环完善项目</div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">🧠 否定思维</h3>
                    <div style="font-size: 0.875rem; color: var(--color-text-secondary); line-height: 1.5;">
                        "否定"不是为了打击，而是为了发现问题、完善方案。每一个"否定"都是帮助项目走向成功的垫脚石。
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">🏆 成功案例</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.875rem;">
                        <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm);">
                            <div style="font-weight: 500;">AI辅助诊断系统</div>
                            <div style="color: var(--color-text-secondary);">经过127次否定，成功获得投资</div>
                        </div>
                        <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm);">
                            <div style="font-weight: 500;">智能农业监测</div>
                            <div style="color: var(--color-text-secondary);">经过89次否定，技术突破</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 中间：主要表单 -->
                <div>
                <div class="card">
                    <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem;">发布新话题</h2>
                    
                    <form id="createTopicForm">
                        <!-- 基本信息 -->
                        <div class="form-group">
                            <label for="topicTitle" class="form-label">话题标题 <span style="color: red;">*</span></label>
                            <input type="text" id="topicTitle" class="form-input" placeholder="简明扼要地描述你的项目或问题" maxlength="100" required>
                            <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">0/100</div>
                    </div>

                        <div class="form-group">
                            <label for="topicCategory" class="form-label">话题分类 <span style="color: red;">*</span></label>
                            <select id="topicCategory" class="form-input" required>
                                <option value="">请选择分类</option>
                                <option value="tech">技术创新</option>
                                <option value="product">产品开发</option>
                                <option value="research">学术研究</option>
                                <option value="business">商业模式</option>
                                <option value="funding">融资需求</option>
                                <option value="cooperation">合作寻求</option>
                                <option value="other">其他</option>
                            </select>
                    </div>

                        <div class="form-group">
                            <label for="topicDescription" class="form-label">详细描述 <span style="color: red;">*</span></label>
                            <textarea id="topicDescription" class="form-input form-textarea" rows="6" placeholder="详细描述你的项目背景、目标、现状和面临的挑战..." maxlength="2000" required></textarea>
                            <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">0/2000</div>
                    </div>

                        <!-- 系统自动分解维度 -->
                        <div class="form-group">
                            <label class="form-label">系统自动分解维度</label>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">📋 项目资源需求</div>
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">⚙️ 技术原理</div>
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">🔧 技术实施</div>
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">💻 软件</div>
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">🔩 硬件</div>
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">📊 市场</div>
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">💰 财务</div>
                                <div style="padding: 0.5rem; background-color: var(--color-background-secondary); border-radius: var(--radius-sm); font-size: 0.875rem;">🏦 融资</div>
                            </div>
                            <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.5rem;">系统将自动按这8个维度对话题进行分解，方便用户针对性讨论</div>
                        </div>

                        <!-- 标签 -->
                        <div class="form-group">
                            <label for="topicTags" class="form-label">相关标签</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem;" id="selectedTags"></div>
                            <input type="text" id="topicTags" class="form-input" placeholder="输入标签后按回车添加（最多5个）">
                            <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">建议标签：AI、机器学习、产品设计、创业、融资等</div>
                        </div>

                        <!-- 发布设置 -->
                        <div class="form-group">
                            <label class="form-label">发布设置</label>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
                                    <input type="checkbox" id="anonymousPost" style="width: auto;">
                                    匿名发布（避免专家主义影响）
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
                                    <input type="checkbox" id="allowNegation" checked style="width: auto;">
                                    允许否定意见（推荐开启）
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
                                    <input type="checkbox" id="autoSaveDraft" checked style="width: auto;">
                                    自动保存草稿
                                </label>
                    </div>
                        </div>

                        <!-- 按钮组 -->
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button type="button" class="btn btn-ghost" onclick="saveDraft()">保存草稿</button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;">发布话题</button>
                        </div>
                    </form>
                </div>
                        </div>

            <!-- 右侧：预览和帮助 -->
                        <div>
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">📝 预览</h3>
                    <div id="topicPreview" style="border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: 1rem; min-height: 200px; background-color: var(--color-background-secondary);">
                        <div style="color: var(--color-text-muted); text-align: center; padding: 2rem 0;">
                            填写表单内容后，这里将显示话题预览
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">🎯 智能建议</h3>
                    <div id="smartSuggestions" style="font-size: 0.875rem; color: var(--color-text-secondary);">
                        <div>💡 建议补充技术细节描述</div>
                        <div style="margin-top: 0.5rem;">💡 建议添加市场前景分析</div>
                        <div style="margin-top: 0.5rem;">💡 建议说明预期投入和回报</div>
                </div>
                </div>

                <div class="card">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">📚 模板库</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <button class="btn btn-ghost btn-sm" onclick="loadTemplate('tech')">技术创新模板</button>
                        <button class="btn btn-ghost btn-sm" onclick="loadTemplate('product')">产品开发模板</button>
                        <button class="btn btn-ghost btn-sm" onclick="loadTemplate('research')">学术研究模板</button>
                        <button class="btn btn-ghost btn-sm" onclick="loadTemplate('business')">商业模式模板</button>
        </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="navigation.js"></script>
    <script src="main.js"></script>
    
    <script>
        // 个人中心下拉菜单功能
        document.addEventListener('DOMContentLoaded', function() {
            const dropdownBtn = document.getElementById('profileDropdownBtn');
            const dropdownMenu = document.getElementById('profileDropdownMenu');
            
            if (dropdownBtn && dropdownMenu) {
                // 点击按钮切换菜单显示
                dropdownBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isVisible = dropdownMenu.style.display !== 'none';
                    dropdownMenu.style.display = isVisible ? 'none' : 'block';
                });
                
                // 点击其他地方关闭菜单
                document.addEventListener('click', function() {
                    dropdownMenu.style.display = 'none';
                });
                
                // 菜单项hover效果
                const dropdownItems = dropdownMenu.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = 'var(--color-background-secondary)';
                    });
                    item.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = 'transparent';
                    });
                });
            }
        });
    </script>
    
    <script>
        let selectedTags = [];
        const maxTags = 5;
        
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 字数统计
            setupCharacterCount('topicTitle', 100);
            setupCharacterCount('topicDescription', 2000);
            
            // 标签输入处理
            setupTagInput();
            
            // 预览更新
            setupPreviewUpdate();
            
            // 自动保存草稿
            setupAutoSave();
            
            // 加载保存的草稿
            loadDraft();
        });
        
        // 字数统计功能
        function setupCharacterCount(inputId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = input.nextElementSibling;
            
            input.addEventListener('input', function() {
                const currentLength = this.value.length;
                counter.textContent = `${currentLength}/${maxLength}`;
                
                if (currentLength > maxLength * 0.9) {
                    counter.style.color = 'var(--color-warning)';
                } else {
                    counter.style.color = 'var(--color-text-muted)';
                }
            });
        }
        
        // 标签输入处理
        function setupTagInput() {
            const tagInput = document.getElementById('topicTags');
            
            tagInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag(this.value.trim());
                    this.value = '';
                }
            });
        }
        
        function addTag(tagText) {
            if (!tagText || selectedTags.length >= maxTags || selectedTags.includes(tagText)) {
                return;
            }
            
            selectedTags.push(tagText);
            updateTagsDisplay();
        }
        
        function removeTag(tagText) {
            selectedTags = selectedTags.filter(tag => tag !== tagText);
            updateTagsDisplay();
        }
        
        function updateTagsDisplay() {
            const container = document.getElementById('selectedTags');
            container.innerHTML = selectedTags.map(tag => 
                `<span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; background-color: var(--color-primary); color: var(--color-secondary); border-radius: var(--radius-sm); font-size: 0.75rem;">
                    ${tag}
                    <button type="button" onclick="removeTag('${tag}')" style="background: none; border: none; color: var(--color-secondary); cursor: pointer; padding: 0; margin-left: 0.25rem;">×</button>
                </span>`
            ).join('');
        }
        
        // 预览更新
        function setupPreviewUpdate() {
            const inputs = ['topicTitle', 'topicCategory', 'topicDescription'];
            inputs.forEach(inputId => {
                document.getElementById(inputId).addEventListener('input', updatePreview);
            });
        }
        
        function updatePreview() {
            const title = document.getElementById('topicTitle').value;
            const category = document.getElementById('topicCategory').value;
            const description = document.getElementById('topicDescription').value;
            
            const preview = document.getElementById('topicPreview');
            
            if (!title && !description) {
                preview.innerHTML = '<div style="color: var(--color-text-muted); text-align: center; padding: 2rem 0;">填写表单内容后，这里将显示话题预览</div>';
                return;
            }
            
            const categoryNames = {
                'tech': '技术创新',
                'product': '产品开发',
                'research': '学术研究',
                'business': '商业模式',
                'funding': '融资需求',
                'cooperation': '合作寻求',
                'other': '其他'
            };
            
            preview.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">${title || '话题标题'}</h4>
                    ${category ? `<span style="padding: 0.25rem 0.5rem; background-color: var(--color-background-tertiary); border-radius: var(--radius-sm); font-size: 0.75rem;">${categoryNames[category]}</span>` : ''}
                </div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary); line-height: 1.5;">
                    ${description || '话题描述'}
                </div>
                ${selectedTags.length > 0 ? `
                <div style="margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.25rem;">
                    ${selectedTags.map(tag => `<span style="padding: 0.25rem 0.5rem; background-color: var(--color-primary); color: var(--color-secondary); border-radius: var(--radius-sm); font-size: 0.75rem;">${tag}</span>`).join('')}
                </div>
                ` : ''}
            `;
        }
        
        // 模板加载
        function loadTemplate(type) {
            const templates = {
                'tech': {
                    title: 'AI驱动的智能诊断系统',
                    category: 'tech',
                    description: '项目背景：传统医疗诊断存在效率低、误诊率高的问题。\n\n技术方案：基于深度学习的医疗影像识别系统，结合多模态数据融合技术。\n\n现状与挑战：\n1. 已完成算法原型开发\n2. 需要大量医疗数据进行训练\n3. 面临数据隐私和监管审批问题\n\n期望合作：寻求医院合作伙伴、数据科学家和投资方',
                    tags: ['AI', '医疗', '深度学习', '诊断系统']
                },
                'product': {
                    title: '面向老年人的智能健康监测产品',
                    category: 'product',
                    description: '产品定位：为老年人提供24小时健康监测和紧急救助的智能设备。\n\n功能特性：\n1. 生命体征实时监测\n2. 跌倒检测和紧急呼救\n3. 用药提醒和健康建议\n4. 家人远程关怀\n\n市场分析：老龄化社会趋势，市场需求巨大。\n\n挑战：产品小型化、续航、成本控制',
                    tags: ['智能硬件', '健康监测', '老年人', '物联网']
                },
                'research': {
                    title: '量子计算在密码学中的应用研究',
                    category: 'research',
                    description: '研究背景：量子计算的发展对传统密码学构成威胁，需要研究量子安全的密码算法。\n\n研究内容：\n1. 后量子密码学算法设计\n2. 量子密钥分发协议优化\n3. 量子-经典混合加密系统\n\n研究现状：已发表3篇论文，获得初步理论成果。\n\n合作需求：寻求量子物理、数学、计算机安全领域的合作者',
                    tags: ['量子计算', '密码学', '信息安全', '后量子密码']
                },
                'business': {
                    title: '共享经济模式下的城市出行解决方案',
                    category: 'business',
                    description: '商业模式：基于AI调度的多模态出行服务平台。\n\n价值主张：\n1. 为用户提供最优出行路线\n2. 整合公交、地铁、共享单车、网约车\n3. 减少城市交通拥堵\n4. 降低用户出行成本\n\n盈利模式：服务费、广告、数据服务\n\n挑战：政府政策、合作伙伴整合、用户习惯培养',
                    tags: ['共享经济', '智慧出行', '平台经济', 'AI调度']
                }
            };
            
            const template = templates[type];
            if (template) {
                document.getElementById('topicTitle').value = template.title;
                document.getElementById('topicCategory').value = template.category;
                document.getElementById('topicDescription').value = template.description;
                
                // 清空并添加新标签
                selectedTags = [];
                template.tags.forEach(tag => addTag(tag));
                
                // 更新字数统计和预览
                setupCharacterCount('topicTitle', 100);
                setupCharacterCount('topicDescription', 2000);
                updatePreview();
            }
        }
        
        // 自动保存草稿
        function setupAutoSave() {
            const inputs = ['topicTitle', 'topicCategory', 'topicDescription'];
            inputs.forEach(inputId => {
                document.getElementById(inputId).addEventListener('input', debounce(saveDraft, 2000));
            });
        }
        
        function saveDraft() {
            const draft = {
                title: document.getElementById('topicTitle').value,
                category: document.getElementById('topicCategory').value,
                description: document.getElementById('topicDescription').value,
                tags: selectedTags,
                anonymous: document.getElementById('anonymousPost').checked,
                allowNegation: document.getElementById('allowNegation').checked,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('topicDraft', JSON.stringify(draft));
            console.log('草稿已保存');
        }
        
        function loadDraft() {
            const draftJson = localStorage.getItem('topicDraft');
            if (draftJson) {
                const draft = JSON.parse(draftJson);
                
                document.getElementById('topicTitle').value = draft.title || '';
                document.getElementById('topicCategory').value = draft.category || '';
                document.getElementById('topicDescription').value = draft.description || '';
                document.getElementById('anonymousPost').checked = draft.anonymous || false;
                document.getElementById('allowNegation').checked = draft.allowNegation !== false;
                
                selectedTags = draft.tags || [];
                updateTagsDisplay();
                updatePreview();
                
                // 更新字数统计
                setupCharacterCount('topicTitle', 100);
                setupCharacterCount('topicDescription', 2000);
            }
        }
        
        // 表单提交
        document.getElementById('createTopicForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('topicTitle').value,
                category: document.getElementById('topicCategory').value,
                description: document.getElementById('topicDescription').value,
                tags: selectedTags,
                anonymous: document.getElementById('anonymousPost').checked,
                allowNegation: document.getElementById('allowNegation').checked,
                timestamp: new Date().toISOString(),
                id: Date.now() // 简单的ID生成
            };
            
            // 保存到localStorage（实际项目中应该发送到服务器）
            const topics = JSON.parse(localStorage.getItem('topics') || '[]');
            topics.unshift(formData);
            localStorage.setItem('topics', JSON.stringify(topics));
            
            // 清除草稿
            localStorage.removeItem('topicDraft');
            
            alert('话题发布成功！');
            window.location.href = `topic_discussion.html?id=${formData.id}`;
        });
        
        // 工具函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>


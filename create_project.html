<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发布项目 - Otherwise</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation Header -->
    <header class="nav">
        <div class="nav-container">
            <div class="nav-brand">
                <span>Otherwise</span>
                <span style="font-weight: 400; color: var(--color-text-secondary); margin-left: 8px;">否则</span>
            </div>
            <nav class="nav-links">
                <a href="index.html" class="nav-link">首页</a>
                <a href="projects.html" class="nav-link">项目话题</a>
                <a href="profile.html" class="nav-link">个人中心</a>
                <div id="navButtons">
                    <!-- Content here will be dynamically inserted by navigation.js -->
                </div>
            </nav>
        </div>
    </header>

    <div class="container" style="padding-top: 2rem; padding-bottom: 2rem;">
        <div class="grid grid-cols-3" style="gap: 2rem;">
            <!-- 主表单区域 -->
            <div style="grid-column: span 2;">
                <!-- 页面标题 -->
                <div style="margin-bottom: 2rem;">
                    <h1 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem;">发布新项目</h1>
                    <p style="color: var(--color-text-secondary); font-size: 0.875rem;">
                        通过"否定驱动创新"的理念，让您的项目接受多角度的审视和完善
                    </p>
                </div>

                <form id="createProjectForm" style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <!-- 基本信息 -->
                    <div class="card">
                        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">基本信息</h2>
                        
                        <div class="form-group">
                            <label for="projectTitle" class="form-label">项目标题 *</label>
                            <input type="text" id="projectTitle" class="form-input" placeholder="请输入项目标题" required>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                建议使用简洁明了的标题，突出项目核心价值
                            </p>
                        </div>

                        <div class="form-group">
                            <label for="projectSubtitle" class="form-label">项目副标题</label>
                            <input type="text" id="projectSubtitle" class="form-input" placeholder="一句话描述项目亮点">
                        </div>

                        <div class="grid grid-cols-2" style="gap: 1rem;">
                            <div class="form-group">
                                <label for="projectIndustry" class="form-label">所属行业 *</label>
                                <select id="projectIndustry" class="form-input" required>
                                    <option value="">请选择行业</option>
                                    <option value="ai">人工智能</option>
                                    <option value="biotech">生物技术</option>
                                    <option value="fintech">金融科技</option>
                                    <option value="manufacturing">智能制造</option>
                                    <option value="healthcare">医疗健康</option>
                                    <option value="education">教育科技</option>
                                    <option value="energy">新能源</option>
                                    <option value="environment">环保科技</option>
                                    <option value="other">其他</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="projectStage" class="form-label">项目阶段 *</label>
                                <select id="projectStage" class="form-input" required>
                                    <option value="">请选择阶段</option>
                                    <option value="concept">概念验证阶段</option>
                                    <option value="research">实验室研发阶段</option>
                                    <option value="prototype">原型开发阶段</option>
                                    <option value="testing">测试验证阶段</option>
                                    <option value="ready">技术成熟，准备产业化</option>
                                    <option value="scaling">规模化生产阶段</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="projectTags" class="form-label">技术标签</label>
                            <div style="margin-bottom: 0.5rem;">
                                <input type="text" id="tagInput" class="form-input" placeholder="输入技术标签，回车添加" 
                                       style="display: inline-block; width: calc(100% - 80px); margin-right: 0.5rem;">
                                <button type="button" onclick="addTag()" class="btn btn-ghost btn-sm">添加</button>
                            </div>
                            <div id="tagsList" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                                <!-- 标签将在这里显示 -->
                            </div>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                添加相关的技术标签，便于其他用户发现您的项目
                            </p>
                        </div>
                    </div>

                    <!-- 项目描述 -->
                    <div class="card">
                        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">项目描述</h2>
                        
                        <div class="form-group">
                            <label for="projectDescription" class="form-label">项目详细描述 *</label>
                            <textarea id="projectDescription" class="form-input form-textarea" rows="6" 
                                      placeholder="详细描述您的项目背景、技术方案、创新点等..." required></textarea>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                建议包含：项目背景、技术方案、创新点、当前进展等
                            </p>
                        </div>

                        <div class="form-group">
                            <label for="technicalAdvantages" class="form-label">技术优势</label>
                            <textarea id="technicalAdvantages" class="form-input form-textarea" rows="4" 
                                      placeholder="描述项目的核心技术优势和竞争力..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="expectedResults" class="form-label">预期成果</label>
                            <textarea id="expectedResults" class="form-input form-textarea" rows="4" 
                                      placeholder="描述项目的预期成果和应用前景..."></textarea>
                        </div>
                    </div>

                    <!-- 合作需求 -->
                    <div class="card">
                        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">合作需求</h2>
                        
                        <div class="form-group">
                            <label class="form-label">寻求合作类型 *</label>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="checkbox" name="cooperationType" value="technical">
                                    <span>技术合作</span>
                                </label>
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="checkbox" name="cooperationType" value="funding">
                                    <span>资金支持</span>
                                </label>
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="checkbox" name="cooperationType" value="market">
                                    <span>市场渠道</span>
                                </label>
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="checkbox" name="cooperationType" value="production">
                                    <span>生产制造</span>
                                </label>
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="checkbox" name="cooperationType" value="research">
                                    <span>研发合作</span>
                                </label>
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="checkbox" name="cooperationType" value="other">
                                    <span>其他</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-2" style="gap: 1rem;">
                            <div class="form-group">
                                <label for="fundingNeeds" class="form-label">资金需求</label>
                                <select id="fundingNeeds" class="form-input">
                                    <option value="">请选择资金需求</option>
                                    <option value="none">无资金需求</option>
                                    <option value="small">100万以下</option>
                                    <option value="medium">100-500万</option>
                                    <option value="large">500-1000万</option>
                                    <option value="huge">1000万以上</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="teamSize" class="form-label">团队规模</label>
                                <select id="teamSize" class="form-input">
                                    <option value="">请选择团队规模</option>
                                    <option value="individual">个人项目</option>
                                    <option value="small">2-5人</option>
                                    <option value="medium">6-15人</option>
                                    <option value="large">16人以上</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="cooperationDetails" class="form-label">合作详情</label>
                            <textarea id="cooperationDetails" class="form-input form-textarea" rows="4" 
                                      placeholder="详细描述您希望的合作方式、合作伙伴要求等..."></textarea>
                        </div>
                    </div>

                    <!-- 项目设置 -->
                    <div class="card">
                        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">项目设置</h2>
                        
                        <div class="grid grid-cols-2" style="gap: 1rem;">
                            <div class="form-group">
                                <label for="recruitmentDeadline" class="form-label">招募截止时间</label>
                                <input type="date" id="recruitmentDeadline" class="form-input">
                                <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                    留空表示长期有效
                                </p>
                            </div>

                            <div class="form-group">
                                <label for="maxParticipants" class="form-label">最大参与人数</label>
                                <input type="number" id="maxParticipants" class="form-input" placeholder="如：10" min="1">
                                <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                    留空表示不限制
                                </p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">项目可见性</label>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem;">
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="radio" name="visibility" value="public" checked>
                                    <span>公开 - 所有用户可见</span>
                                </label>
                                <label class="flex items-center" style="gap: 0.5rem;">
                                    <input type="radio" name="visibility" value="limited">
                                    <span>限制 - 仅特定用户类型可见</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="flex items-center" style="gap: 0.5rem;">
                                <input type="checkbox" id="allowNegation">
                                <span>允许否定观点</span>
                            </label>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                勾选后，其他用户可以对您的项目提出否定观点，这有助于发现潜在问题
                            </p>
                        </div>
                    </div>

                    <!-- 联系信息 -->
                    <div class="card">
                        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">联系信息</h2>
                        
                        <div class="form-group">
                            <label for="contactInfo" class="form-label">联系方式</label>
                            <textarea id="contactInfo" class="form-input form-textarea" rows="3" 
                                      placeholder="请提供邮箱、电话或其他联系方式..."></textarea>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                联系方式将在用户表达合作兴趣后显示
                            </p>
                        </div>

                        <div class="form-group">
                            <label class="flex items-center" style="gap: 0.5rem;">
                                <input type="checkbox" id="hideContact">
                                <span>隐藏联系方式</span>
                            </label>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                                勾选后，联系方式仅在用户申请合作后显示
                            </p>
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="flex justify-end" style="gap: 1rem; margin-top: 2rem;">
                        <button type="button" onclick="saveDraft()" class="btn btn-ghost">保存草稿</button>
                        <button type="submit" class="btn btn-primary">发布项目</button>
                    </div>
                </form>
            </div>

            <!-- 侧边栏 -->
            <div>
                <!-- 发布指南 -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">📝 发布指南</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.875rem;">
                        <div>
                            <strong>1. 清晰的项目描述</strong>
                            <p style="color: var(--color-text-secondary); margin: 0.25rem 0;">详细说明项目背景、技术方案和创新点</p>
                        </div>
                        <div>
                            <strong>2. 明确的合作需求</strong>
                            <p style="color: var(--color-text-secondary); margin: 0.25rem 0;">具体说明需要什么类型的合作伙伴</p>
                        </div>
                        <div>
                            <strong>3. 拥抱否定观点</strong>
                            <p style="color: var(--color-text-secondary); margin: 0.25rem 0;">否定观点有助于发现项目的潜在问题</p>
                        </div>
                        <div>
                            <strong>4. 及时回应讨论</strong>
                            <p style="color: var(--color-text-secondary); margin: 0.25rem 0;">积极参与项目讨论，回应用户关切</p>
                        </div>
                    </div>
                </div>

                <!-- 否定思维提示 -->
                <div class="card" style="margin-bottom: 1.5rem; border-left: 4px solid #ff6b6b;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">🚫 否定思维提示</h3>
                    <div style="font-size: 0.875rem; line-height: 1.5;">
                        <p style="margin-bottom: 0.75rem;">
                            在发布项目前，请先从以下角度审视您的项目：
                        </p>
                        <ul style="list-style: disc; padding-left: 1rem; color: var(--color-text-secondary);">
                            <li style="margin-bottom: 0.25rem;">技术方案是否存在缺陷？</li>
                            <li style="margin-bottom: 0.25rem;">市场需求是否真实存在？</li>
                            <li style="margin-bottom: 0.25rem;">竞争对手的优势在哪里？</li>
                            <li style="margin-bottom: 0.25rem;">资源配置是否合理？</li>
                            <li style="margin-bottom: 0.25rem;">风险评估是否充分？</li>
                        </ul>
                        <p style="margin-top: 0.75rem; color: var(--color-text-secondary);">
                            通过自我否定，让项目更加完善！
                        </p>
                    </div>
                </div>

                <!-- 成功案例 -->
                <div class="card">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">🎯 成功案例</h3>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div style="padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--border-radius);">
                            <h4 style="font-weight: 500; margin-bottom: 0.25rem; font-size: 0.875rem;">智能制造系统</h4>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;">
                                通过平台找到3家合作伙伴，获得500万投资
                            </p>
                            <div style="font-size: 0.75rem; color: #00b894;">✅ 已成功产业化</div>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--border-radius);">
                            <h4 style="font-weight: 500; margin-bottom: 0.25rem; font-size: 0.875rem;">医疗AI诊断</h4>
                            <p style="font-size: 0.75rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;">
                                接受15个否定观点，优化算法后获得医院合作
                            </p>
                            <div style="font-size: 0.75rem; color: #fdcb6e;">⏳ 临床试验中</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="navigation.js"></script>
    <script src="main.js"></script>

    <script>
        let projectTags = [];

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 设置默认截止时间为30天后
            const defaultDeadline = new Date();
            defaultDeadline.setDate(defaultDeadline.getDate() + 30);
            document.getElementById('recruitmentDeadline').value = defaultDeadline.toISOString().split('T')[0];

            // 默认允许否定观点
            document.getElementById('allowNegation').checked = true;

            // 标签输入框回车事件
            document.getElementById('tagInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag();
                }
            });

            // 表单提交事件
            document.getElementById('createProjectForm').addEventListener('submit', handleSubmit);
        });

        // 添加标签
        function addTag() {
            const tagInput = document.getElementById('tagInput');
            const tag = tagInput.value.trim();
            
            if (tag && !projectTags.includes(tag)) {
                projectTags.push(tag);
                updateTagsDisplay();
                tagInput.value = '';
            }
        }

        // 移除标签
        function removeTag(tag) {
            projectTags = projectTags.filter(t => t !== tag);
            updateTagsDisplay();
        }

        // 更新标签显示
        function updateTagsDisplay() {
            const tagsList = document.getElementById('tagsList');
            tagsList.innerHTML = projectTags.map(tag => 
                `<span class="tag" style="display: flex; align-items: center; gap: 0.25rem;">
                    ${tag}
                    <button type="button" onclick="removeTag('${tag}')" style="background: none; border: none; color: var(--color-text-secondary); cursor: pointer; font-size: 0.75rem;">✕</button>
                </span>`
            ).join('');
        }

        // 保存草稿
        function saveDraft() {
            const formData = collectFormData();
            localStorage.setItem('projectDraft', JSON.stringify(formData));
            alert('草稿已保存');
        }

        // 收集表单数据
        function collectFormData() {
            const cooperationTypes = Array.from(document.querySelectorAll('input[name="cooperationType"]:checked'))
                .map(cb => cb.value);
            
            return {
                title: document.getElementById('projectTitle').value,
                subtitle: document.getElementById('projectSubtitle').value,
                industry: document.getElementById('projectIndustry').value,
                stage: document.getElementById('projectStage').value,
                tags: projectTags,
                description: document.getElementById('projectDescription').value,
                technicalAdvantages: document.getElementById('technicalAdvantages').value,
                expectedResults: document.getElementById('expectedResults').value,
                cooperationTypes: cooperationTypes,
                fundingNeeds: document.getElementById('fundingNeeds').value,
                teamSize: document.getElementById('teamSize').value,
                cooperationDetails: document.getElementById('cooperationDetails').value,
                recruitmentDeadline: document.getElementById('recruitmentDeadline').value,
                maxParticipants: document.getElementById('maxParticipants').value,
                visibility: document.querySelector('input[name="visibility"]:checked').value,
                allowNegation: document.getElementById('allowNegation').checked,
                contactInfo: document.getElementById('contactInfo').value,
                hideContact: document.getElementById('hideContact').checked
            };
        }

        // 处理表单提交
        function handleSubmit(e) {
            e.preventDefault();
            
            // 验证必填字段
            const requiredFields = ['projectTitle', 'projectIndustry', 'projectStage', 'projectDescription'];
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = '#ff6b6b';
                    isValid = false;
                } else {
                    field.style.borderColor = 'var(--color-border)';
                }
            });

            // 验证合作类型
            const cooperationTypes = document.querySelectorAll('input[name="cooperationType"]:checked');
            if (cooperationTypes.length === 0) {
                alert('请至少选择一种合作类型');
                isValid = false;
            }

            if (!isValid) {
                alert('请填写所有必填字段');
                return;
            }

            // 收集表单数据
            const formData = collectFormData();
            
            // 添加项目ID和时间戳
            formData.id = 'project_' + Date.now();
            formData.publishedAt = new Date().toISOString();
            formData.status = 'recruiting';
            formData.views = 0;
            formData.interestedCount = 0;
            formData.followCount = 0;

            // 保存到本地存储（实际应用中应该发送到服务器）
            const existingProjects = JSON.parse(localStorage.getItem('userProjects') || '[]');
            existingProjects.push(formData);
            localStorage.setItem('userProjects', JSON.stringify(existingProjects));

            // 清除草稿
            localStorage.removeItem('projectDraft');

            // 显示成功消息
            alert('项目发布成功！');
            
            // 跳转到项目列表页面
            window.location.href = 'projects.html';
        }

        // 加载草稿（如果有的话）
        function loadDraft() {
            const draft = localStorage.getItem('projectDraft');
            if (draft) {
                const data = JSON.parse(draft);
                
                // 填充表单字段
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = data[key];
                        } else if (element.type === 'radio') {
                            if (element.value === data[key]) {
                                element.checked = true;
                            }
                        } else {
                            element.value = data[key];
                        }
                    }
                });

                // 恢复标签
                if (data.tags) {
                    projectTags = data.tags;
                    updateTagsDisplay();
                }

                // 恢复合作类型
                if (data.cooperationTypes) {
                    data.cooperationTypes.forEach(type => {
                        const checkbox = document.querySelector(`input[name="cooperationType"][value="${type}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            }
        }

        // 页面加载时尝试加载草稿
        window.addEventListener('load', loadDraft);
    </script>
</body>
</html>

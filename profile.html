<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - Otherwise</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation Header -->
    <header class="nav">
        <div class="nav-container">
            <div class="nav-brand">
                <span>Otherwise</span>
                <span style="font-weight: 400; color: var(--color-text-secondary); margin-left: 8px;">å¦åˆ™</span>
                </div>
            <nav class="nav-links">
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="projects.html" class="nav-link">é¡¹ç›®è¯é¢˜</a>
                <a href="create_topic.html" class="nav-link">å‘å¸ƒè¯é¢˜</a>
                
                <!-- ä¸ªäººä¸­å¿ƒä¸‹æ‹‰èœå• -->
                <div class="nav-dropdown" style="position: relative;">
                    <button id="profileDropdownBtn" class="nav-link" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                        <span>ä¸ªäººä¸­å¿ƒ</span>
                        <span style="font-size: 0.75rem;">â–¼</span>
                    </button>
                    <div id="profileDropdownMenu" class="dropdown-menu" style="display: none; position: absolute; top: 100%; right: 0; background: var(--color-background); border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-lg); min-width: 200px; z-index: 50;">
                        <a href="profile.html" class="dropdown-item" style="display: block; padding: 0.75rem 1rem; color: var(--color-text-primary); text-decoration: none; border-bottom: 1px solid var(--color-border); background: var(--color-background-secondary);">
                            <span style="margin-right: 0.5rem;">ğŸ‘¤</span>æˆ‘çš„èµ„æ–™
                        </a>
                        <a href="projects.html" class="dropdown-item" style="display: block; padding: 0.75rem 1rem; color: var(--color-text-primary); text-decoration: none; border-bottom: 1px solid var(--color-border);">
                            <span style="margin-right: 0.5rem;">ğŸ“‹</span>æˆ‘çš„é¡¹ç›®
                        </a>
                        <a href="bounty_system.html" class="dropdown-item" style="display: block; padding: 0.75rem 1rem; color: var(--color-text-primary); text-decoration: none; border-bottom: 1px solid var(--color-border);">
                            <span style="margin-right: 0.5rem;">ğŸ’°</span>æ‚¬èµä»¤
                        </a>
                        <button onclick="window.logout()" class="dropdown-item" style="display: block; width: 100%; text-align: left; padding: 0.75rem 1rem; color: var(--color-text-secondary); background: none; border: none; cursor: pointer;">
                            <span style="margin-right: 0.5rem;">ğŸšª</span>é€€å‡ºç™»å½•
                        </button>
                    </div>
                </div>
                
                <div id="navButtons">
                    <!-- Content here will be dynamically inserted by navigation.js -->
                </div>
            </nav>
            </div>
    </header>

    <div class="container" style="padding-top: 2rem; padding-bottom: 2rem;">
        <div class="grid grid-cols-3" style="gap: 2rem;">
            <!-- ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
            <div>
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="text-center" style="margin-bottom: 1.5rem;">
                        <!-- å¤´åƒä¸Šä¼ åŒºåŸŸ -->
                        <div style="position: relative; margin-bottom: 1rem;">
                            <div class="avatar-container" id="avatarDisplay">
                                <div class="avatar-placeholder" id="avatarPlaceholder">ğŸ‘¤</div>
                                <img id="avatarImage" class="avatar-image" style="display: none;" alt="ç”¨æˆ·å¤´åƒ">
                            </div>
                            <button onclick="triggerAvatarUpload()" style="position: absolute; bottom: 0; right: calc(50% - 40px + 28px); background-color: var(--color-primary); color: var(--color-secondary); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; border: none; cursor: pointer;">
                                ğŸ“·
                            </button>
                            <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯æ˜¾ç¤º -->
                        <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.25rem;" id="displayNickname">åŠ è½½ä¸­...</h2>
                        <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;" id="displayUserType">åŠ è½½ä¸­...</p>
                        <div id="displayTags" style="display: flex; flex-wrap: wrap; gap: 0.25rem; justify-content: center;">
                            <!-- ç”¨æˆ·æ ‡ç­¾å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 1rem;" id="profileDetails">
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">æ‰€å±æœºæ„</label>
                            <p style="font-size: 0.875rem;" id="displayOrganization">åŠ è½½ä¸­...</p>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">ç ”ç©¶æ–¹å‘</label>
                            <p style="font-size: 0.875rem;" id="displayResearchField">åŠ è½½ä¸­...</p>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">ä¸ªäººç®€ä»‹</label>
                            <p style="font-size: 0.875rem;" id="displayBio">æš‚æ— ç®€ä»‹</p>
                        </div>
                        
                        <!-- ç»Ÿè®¡æ•°æ® -->
                        <div class="flex justify-between" style="font-size: 0.875rem; border-top: 1px solid var(--color-border); padding-top: 1rem;" id="profileStats">
                            <div class="text-center">
                                <div style="font-weight: 600;" id="followersCount">--</div>
                                <div style="color: var(--color-text-secondary);">ç²‰ä¸</div>
                            </div>
                            <div class="text-center">
                                <div style="font-weight: 600;" id="followingCount">--</div>
                                <div style="color: var(--color-text-secondary);">å…³æ³¨</div>
                            </div>
                            <div class="text-center">
                                <div style="font-weight: 600;" id="projectsCount">--</div>
                                <div style="color: var(--color-text-secondary);">é¡¹ç›®</div>
                            </div>
                        </div>
                        
                        <button onclick="openEditModal()" class="btn btn-primary" style="width: 100%;">
                            ç¼–è¾‘èµ„æ–™
                        </button>
                    </div>
                </div>

                <!-- èº«ä»½éªŒè¯çŠ¶æ€ -->
                <div class="card">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">èº«ä»½éªŒè¯</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <div class="flex justify-between items-center">
                            <span style="font-size: 0.875rem; color: var(--color-text-secondary);">é‚®ç®±éªŒè¯</span>
                            <span class="status-badge status-completed" id="emailVerifyStatus">å·²éªŒè¯</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span style="font-size: 0.875rem; color: var(--color-text-secondary);">èº«ä»½è®¤è¯</span>
                            <span class="status-badge status-pending" id="identityVerifyStatus">å¾…è®¤è¯</span>
                        </div>
                    </div>
                    <button style="margin-top: 0.75rem; font-size: 0.875rem; color: var(--color-text-secondary); background: none; border: none; cursor: pointer; text-decoration: underline;">ç”³è¯·èº«ä»½è®¤è¯</button>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <div style="grid-column: span 2;">
                <!-- æ ‡ç­¾å¯¼èˆª -->
                <div class="card" style="margin-bottom: 1.5rem; padding: 0;">
                    <div style="border-bottom: 1px solid var(--color-border);">
                        <nav class="flex" style="padding: 0 1.5rem;">
                            <button class="profile-tab" data-tab="overview" style="border-bottom: 2px solid var(--color-primary); color: var(--color-text-primary); padding: 1rem 2rem; background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; font-weight: 500;">
                                æ¦‚è§ˆ
                            </button>
                            <button class="profile-tab" data-tab="projects" style="border-bottom: 2px solid transparent; color: var(--color-text-secondary); padding: 1rem 2rem; background: none; border: none; cursor: pointer;">
                                æˆ‘çš„é¡¹ç›®
                            </button>
                            <button class="profile-tab" data-tab="discussions" style="border-bottom: 2px solid transparent; color: var(--color-text-secondary); padding: 1rem 2rem; background: none; border: none; cursor: pointer;">
                                å‚ä¸è®¨è®º
                            </button>
                            <button class="profile-tab" data-tab="negations" style="border-bottom: 2px solid transparent; color: var(--color-text-secondary); padding: 1rem 2rem; background: none; border: none; cursor: pointer;">
                                å¦å®šè®°å½•
                            </button>
                        </nav>
                    </div>

                    <!-- æ¦‚è§ˆ Tab Content -->
                    <div id="overview" class="tab-content" style="padding: 1.5rem;">
                        <div class="grid grid-cols-2" style="gap: 1.5rem;">
                            <!-- æœ€è¿‘æ´»åŠ¨ -->
                            <div>
                                <h4 style="font-size: 1.125rem; font-weight: 500; margin-bottom: 1rem;">æœ€è¿‘æ´»åŠ¨</h4>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;" id="recentActivity">
                                    <div class="card-minimal" style="padding: 0.75rem;">
                                        <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">å‚ä¸äº†è¯é¢˜è®¨è®º</div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-secondary);">ã€ŠåŸºäºAIçš„æ™ºèƒ½æ¨èç³»ç»Ÿã€‹</div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">2å°æ—¶å‰</div>
                                    </div>
                                    <div class="card-minimal" style="padding: 0.75rem;">
                                        <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">å‘è¡¨äº†å¦å®šæ„è§</div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-secondary);">å¯¹æŠ€æœ¯å®æ–½æ–¹æ¡ˆæå‡ºè´¨ç–‘</div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">1å¤©å‰</div>
                                    </div>
                                    <div class="card-minimal" style="padding: 0.75rem;">
                                        <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">å…³æ³¨äº†æ–°ç”¨æˆ·</div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-secondary);">æäº§å“ç»ç†</div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">3å¤©å‰</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å…³æ³¨çš„è¯é¢˜ -->
                            <div>
                                <h4 style="font-size: 1.125rem; font-weight: 500; margin-bottom: 1rem;">å…³æ³¨çš„è¯é¢˜</h4>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;" id="followedTopics">
                                    <div class="card-minimal" style="padding: 0.75rem;">
                                        <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">åŸºäºAIçš„æ™ºèƒ½æ¨èç³»ç»Ÿ</div>
                                        <div class="flex" style="gap: 0.25rem; margin-bottom: 0.25rem;">
                                            <span class="tag">äººå·¥æ™ºèƒ½</span>
                                            <span class="tag">æ¨èç³»ç»Ÿ</span>
                                        </div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-muted);">è®¨è®ºçƒ­åº¦ï¼šé«˜</div>
                                    </div>
                                    <div class="card-minimal" style="padding: 0.75rem;">
                                        <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">åŒºå—é“¾åœ¨ä¾›åº”é“¾ä¸­çš„åº”ç”¨</div>
                                        <div class="flex" style="gap: 0.25rem; margin-bottom: 0.25rem;">
                                            <span class="tag">åŒºå—é“¾</span>
                                            <span class="tag">ä¾›åº”é“¾</span>
                                        </div>
                                        <div style="font-size: 0.75rem; color: var(--color-text-muted);">è®¨è®ºçƒ­åº¦ï¼šä¸­</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æˆ‘çš„é¡¹ç›® Tab Content -->
                    <div id="projects" class="tab-content" style="padding: 1.5rem; display: none;">
                        <div class="flex justify-between items-center" style="margin-bottom: 1rem;">
                            <h4 style="font-size: 1.125rem; font-weight: 500;">æˆ‘çš„é¡¹ç›®</h4>
                            <button onclick="window.location.href='create_topic.html'" class="btn btn-primary btn-sm">
                                å‘å¸ƒæ–°é¡¹ç›®
                            </button>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 1rem;" id="myProjectsList">
                            <div class="card-minimal" style="padding: 1rem;">
                                <div class="flex justify-between items-start" style="margin-bottom: 0.5rem;">
                                    <h5 style="font-size: 1rem; font-weight: 500;">æ™ºèƒ½å®¢æœç³»ç»Ÿå¼€å‘</h5>
                                    <span class="status-badge status-active">è¿›è¡Œä¸­</span>
                                </div>
                                <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;">åŸºäºè‡ªç„¶è¯­è¨€å¤„ç†çš„æ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œæ”¯æŒå¤šè½®å¯¹è¯å’Œæƒ…æ„Ÿåˆ†æ</p>
                                <div class="flex" style="gap: 0.25rem; margin-bottom: 0.5rem;">
                                    <span class="tag">NLP</span>
                                    <span class="tag">å¯¹è¯ç³»ç»Ÿ</span>
                                    <span class="tag">æƒ…æ„Ÿåˆ†æ</span>
                                </div>
                                <div style="font-size: 0.75rem; color: var(--color-text-muted);">å‘å¸ƒäº 2024-06-15 Â· 12 æ¡è®¨è®º</div>
                            </div>
                        </div>
                    </div>

                    <!-- å‚ä¸è®¨è®º Tab Content -->
                    <div id="discussions" class="tab-content" style="padding: 1.5rem; display: none;">
                        <h4 style="font-size: 1.125rem; font-weight: 500; margin-bottom: 1rem;">å‚ä¸çš„è®¨è®º</h4>
                        <div style="display: flex; flex-direction: column; gap: 1rem;" id="myDiscussionsList">
                            <div class="card-minimal" style="padding: 1rem;">
                                <div style="font-size: 0.875rem; margin-bottom: 0.5rem;">åœ¨ã€ŠåŸºäºAIçš„æ™ºèƒ½æ¨èç³»ç»Ÿã€‹ä¸­å‘è¡¨äº†æ„è§</div>
                                <div style="background-color: var(--color-background-secondary); padding: 0.75rem; border-radius: var(--radius-md); margin-bottom: 0.5rem;">
                                    <p style="font-size: 0.875rem;">"æ¨èç®—æ³•çš„å†·å¯åŠ¨é—®é¢˜éœ€è¦æ›´æ·±å…¥çš„è€ƒè™‘ï¼Œå»ºè®®ç»“åˆç”¨æˆ·ç”»åƒå’Œå†…å®¹ç‰¹å¾..."</p>
                                </div>
                                <div style="font-size: 0.75rem; color: var(--color-text-muted);">2å°æ—¶å‰ Â· è·å¾— 3 ä¸ªèµåŒ</div>
                            </div>
                        </div>
                    </div>

                    <!-- å¦å®šè®°å½• Tab Content -->
                    <div id="negations" class="tab-content" style="padding: 1.5rem; display: none;">
                        <h4 style="font-size: 1.125rem; font-weight: 500; margin-bottom: 1rem;">æˆ‘çš„å¦å®šè®°å½•</h4>
                        <div style="display: flex; flex-direction: column; gap: 1rem;" id="myNegationsList">
                            <div class="card-minimal" style="padding: 1rem; border-left: 3px solid var(--color-primary);">
                                <div style="font-size: 0.875rem; margin-bottom: 0.5rem;">å¦å®šäº†ã€ŠåŒºå—é“¾åœ¨ä¾›åº”é“¾ä¸­çš„åº”ç”¨ã€‹çš„æŠ€æœ¯å®æ–½æ–¹æ¡ˆ</div>
                                <div style="background-color: var(--color-background-tertiary); padding: 0.75rem; border-radius: var(--radius-md); margin-bottom: 0.5rem;">
                                    <p style="font-size: 0.875rem;">"å½“å‰åŒºå—é“¾æŠ€æœ¯çš„TPSé™åˆ¶ä½¿å…¶éš¾ä»¥æ”¯æ’‘å¤§è§„æ¨¡ä¾›åº”é“¾åº”ç”¨"</p>
                                </div>
                                <div style="font-size: 0.75rem; color: var(--color-text-muted);">1å¤©å‰ Â· å¼•å‘ 5 æ¡å›å¤</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡† -->
    <div id="editProfileModal" style="display: none; position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 50; padding: 1rem; overflow-y: auto;">
        <div style="position: relative; top: 5%; margin: 0 auto; max-width: 600px;">
            <div class="card" style="padding: 2rem;">
                <div class="flex justify-between items-center" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.25rem; font-weight: 600;">ç¼–è¾‘ä¸ªäººèµ„æ–™</h3>
                    <button onclick="closeEditModal()" style="background: none; border: none; color: var(--color-text-muted); cursor: pointer; font-size: 1.25rem;">âœ•</button>
                </div>
                
                <form id="editProfileForm">
                    <div class="form-group">
                        <label for="editNickname" class="form-label">æ˜µç§°</label>
                        <input type="text" id="editNickname" class="form-input" placeholder="è¯·è¾“å…¥æ˜µç§°">
                        </div>
                        
                    <div class="form-group">
                        <label for="editOrganization" class="form-label">æ‰€å±æœºæ„</label>
                        <input type="text" id="editOrganization" class="form-input" placeholder="è¯·è¾“å…¥æ‰€å±æœºæ„">
                    </div>
                    
                    <div class="form-group">
                        <label for="editResearchField" class="form-label">ç ”ç©¶æ–¹å‘</label>
                        <input type="text" id="editResearchField" class="form-input" placeholder="è¯·è¾“å…¥ç ”ç©¶æ–¹å‘">
                    </div>
                    
                    <div class="form-group">
                        <label for="editBio" class="form-label">ä¸ªäººç®€ä»‹</label>
                        <textarea id="editBio" class="form-input form-textarea" placeholder="è¯·è¾“å…¥ä¸ªäººç®€ä»‹"></textarea>
                    </div>
                    
                    <div class="flex justify-end" style="gap: 0.75rem;">
                        <button type="button" onclick="closeEditModal()" class="btn btn-ghost">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="navigation.js?v=20241219"></script>
    <script src="main.js?v=20241219"></script>
    <script src="profile-edit.js?v=20241219"></script>
    
    <script>
        // ä¸ªäººä¸­å¿ƒä¸‹æ‹‰èœå•åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const dropdownBtn = document.getElementById('profileDropdownBtn');
            const dropdownMenu = document.getElementById('profileDropdownMenu');
            
            if (dropdownBtn && dropdownMenu) {
                // ç‚¹å‡»æŒ‰é’®åˆ‡æ¢èœå•æ˜¾ç¤º
                dropdownBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isVisible = dropdownMenu.style.display !== 'none';
                    dropdownMenu.style.display = isVisible ? 'none' : 'block';
                });
                
                // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
                document.addEventListener('click', function() {
                    dropdownMenu.style.display = 'none';
                });
                
                // èœå•é¡¹hoveræ•ˆæœ
                const dropdownItems = dropdownMenu.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.addEventListener('mouseenter', function() {
                        if (!this.style.backgroundColor || this.style.backgroundColor === 'transparent') {
                            this.style.backgroundColor = 'var(--color-background-secondary)';
                        }
                    });
                    item.addEventListener('mouseleave', function() {
                        if (this.getAttribute('href') !== 'profile.html') {
                            this.style.backgroundColor = 'transparent';
                        }
                    });
                });
            }
        });
    </script>

    <script>
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ä¸ªäººä¸­å¿ƒé¡µé¢å¼€å§‹åˆå§‹åŒ–...');
            
            // æ¸…ç†æ— æ•ˆç”¨æˆ·æ•°æ®
            clearInvalidUserData();
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn) {
                console.log('ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                window.location.href = 'login.html?redirect=profile.html';
                return;
            }

            // åˆå§‹åŒ–ä¸ªäººèµ„æ–™åŠŸèƒ½
            if (typeof ProfileManager !== 'undefined') {
                console.log('åˆå§‹åŒ–ProfileManager...');
            const profileManager = new ProfileManager();
            profileManager.init();
            } else {
                console.log('ProfileManageræœªå®šä¹‰ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                initializeDefaultProfile();
            }

            // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            initTabSwitching();
            
            // å¤´åƒä¸Šä¼ åŠŸèƒ½
            initAvatarUpload();
            
            // æ¨¡æ€æ¡†åŠŸèƒ½
            initModalFunctions();
            
            console.log('ä¸ªäººä¸­å¿ƒé¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });

        // æ¸…ç†æ— æ•ˆç”¨æˆ·æ•°æ®
        function clearInvalidUserData() {
            const username = localStorage.getItem('username');
            if (username === 'GGod' || username === 'ggod' || !username) {
                console.log('æ¸…ç†æ— æ•ˆç”¨æˆ·æ•°æ®');
                localStorage.removeItem('username');
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                // è®¾ç½®é»˜è®¤ç”¨æˆ·
                localStorage.setItem('username', 'å¼ ç ”ç©¶å‘˜');
                localStorage.setItem('isLoggedIn', 'true');
            }
        }

        // åˆå§‹åŒ–é»˜è®¤ä¸ªäººèµ„æ–™
        function initializeDefaultProfile() {
            const username = localStorage.getItem('username') || 'å¼ ç ”ç©¶å‘˜';
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('displayNickname').textContent = username;
            document.getElementById('displayUserType').textContent = 'é«˜ç­‰é™¢æ ¡ç ”ç©¶è€…';
            document.getElementById('displayOrganization').textContent = 'æ¸…åå¤§å­¦è®¡ç®—æœºç³»';
            document.getElementById('displayResearchField').textContent = 'äººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹ ';
            document.getElementById('displayBio').textContent = 'ä¸“æ³¨äºäººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ é¢†åŸŸçš„ç ”ç©¶ï¼Œè‡´åŠ›äºæ¨åŠ¨AIæŠ€æœ¯åœ¨å®é™…åº”ç”¨ä¸­çš„è½åœ°ã€‚';
            document.getElementById('followersCount').textContent = '128';
            document.getElementById('followingCount').textContent = '45';
            document.getElementById('projectsCount').textContent = '3';
            
            // æ˜¾ç¤ºç”¨æˆ·æ ‡ç­¾
            const tagsContainer = document.getElementById('displayTags');
            tagsContainer.innerHTML = `
                <span class="tag">äººå·¥æ™ºèƒ½</span>
                <span class="tag">æœºå™¨å­¦ä¹ </span>
                <span class="tag">æ·±åº¦å­¦ä¹ </span>
            `;
            
            // æ¢å¤ä¿å­˜çš„å¤´åƒ
            const savedAvatar = localStorage.getItem('userAvatar');
            const avatarImage = document.getElementById('avatarImage');
            const avatarPlaceholder = document.getElementById('avatarPlaceholder');
            
            if (savedAvatar && avatarImage && avatarPlaceholder) {
                avatarImage.src = savedAvatar;
                avatarImage.style.display = 'block';
                avatarPlaceholder.style.display = 'none';
                console.log('å·²æ¢å¤ä¿å­˜çš„å¤´åƒ');
            } else if (avatarPlaceholder) {
                // å¦‚æœæ²¡æœ‰å¤´åƒï¼Œæ˜¾ç¤ºç”¨æˆ·åé¦–å­—æ¯
                const displayName = document.getElementById('displayNickname').textContent || username;
                avatarPlaceholder.textContent = displayName.charAt(0).toUpperCase();
                avatarPlaceholder.style.display = 'flex';
                if (avatarImage) avatarImage.style.display = 'none';
            }
        }

        // åˆå§‹åŒ–æ ‡ç­¾é¡µåˆ‡æ¢
        function initTabSwitching() {
            document.querySelectorAll('.profile-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.profile-tab').forEach(t => {
                        t.style.borderBottom = '2px solid transparent';
                        t.style.color = 'var(--color-text-secondary)';
                        t.style.fontWeight = '400';
                    });
                    
                    // è®¾ç½®å½“å‰æ ‡ç­¾ä¸ºæ´»åŠ¨çŠ¶æ€
                    this.style.borderBottom = '2px solid var(--color-primary)';
                    this.style.color = 'var(--color-text-primary)';
                    this.style.fontWeight = '500';
                    
                    // éšè—æ‰€æœ‰å†…å®¹
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // æ˜¾ç¤ºç›®æ ‡å†…å®¹
                    const targetContent = document.getElementById(targetTab);
                    if (targetContent) {
                        targetContent.style.display = 'block';
                    }
                });
            });
        }

        // åˆå§‹åŒ–å¤´åƒä¸Šä¼ 
        function initAvatarUpload() {
            const avatarInput = document.getElementById('avatarInput');
            if (avatarInput) {
                avatarInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        console.log('é€‰æ‹©çš„æ–‡ä»¶:', file.name, file.type, file.size);
                        
                        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                        if (!file.type.startsWith('image/')) {
                            alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                            return;
                        }
                        
                        // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼‰
                        if (file.size > 5 * 1024 * 1024) {
                            alert('å›¾ç‰‡æ–‡ä»¶ä¸èƒ½è¶…è¿‡5MB');
                            return;
                        }
                        
                        // åˆ›å»ºFileReaderè¯»å–æ–‡ä»¶
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const avatarImage = document.getElementById('avatarImage');
                            const avatarPlaceholder = document.getElementById('avatarPlaceholder');
                            
                            if (avatarImage && avatarPlaceholder) {
                                // è®¾ç½®å›¾ç‰‡æº
                                avatarImage.src = e.target.result;
                                
                                // æ˜¾ç¤ºå›¾ç‰‡ï¼Œéšè—å ä½ç¬¦
                                avatarImage.style.display = 'block';
                                avatarPlaceholder.style.display = 'none';
                                
                                // ä¿å­˜åˆ°localStorage
                                localStorage.setItem('userAvatar', e.target.result);
                                console.log('å¤´åƒå·²æ›´æ–°å¹¶ä¿å­˜');
                            }
                        };
                        
                        reader.onerror = function() {
                            console.error('æ–‡ä»¶è¯»å–å¤±è´¥');
                            alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
                        };
                        
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // åˆå§‹åŒ–æ¨¡æ€æ¡†åŠŸèƒ½
        function initModalFunctions() {
            const editForm = document.getElementById('editProfileForm');
            if (editForm) {
                editForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // æ›´æ–°æ˜¾ç¤ºçš„æ•°æ®
                    const nickname = document.getElementById('editNickname').value;
                    const organization = document.getElementById('editOrganization').value;
                    const researchField = document.getElementById('editResearchField').value;
                    const bio = document.getElementById('editBio').value;
                    
                    if (nickname) document.getElementById('displayNickname').textContent = nickname;
                    if (organization) document.getElementById('displayOrganization').textContent = organization;
                    if (researchField) document.getElementById('displayResearchField').textContent = researchField;
                    if (bio) document.getElementById('displayBio').textContent = bio;
                    
                    // ä¿å­˜åˆ°localStorage
                    const profileData = {
                        nickname: nickname || document.getElementById('displayNickname').textContent,
                        organization: organization || document.getElementById('displayOrganization').textContent,
                        researchField: researchField || document.getElementById('displayResearchField').textContent,
                        bio: bio || document.getElementById('displayBio').textContent
                    };
                    localStorage.setItem('userProfile', JSON.stringify(profileData));
                    
                    closeEditModal();
                    console.log('ä¸ªäººèµ„æ–™å·²æ›´æ–°');
                });
            }
        }

        // å¤´åƒä¸Šä¼ è§¦å‘
        function triggerAvatarUpload() {
            document.getElementById('avatarInput').click();
        }

        // æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
        function openEditModal() {
            document.getElementById('editProfileModal').style.display = 'block';
            
            // å¡«å……å½“å‰æ•°æ®
            document.getElementById('editNickname').value = document.getElementById('displayNickname').textContent;
            document.getElementById('editOrganization').value = document.getElementById('displayOrganization').textContent;
            document.getElementById('editResearchField').value = document.getElementById('displayResearchField').textContent;
            const currentBio = document.getElementById('displayBio').textContent;
            document.getElementById('editBio').value = currentBio === 'æš‚æ— ç®€ä»‹' ? '' : currentBio;
        }

        // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditModal() {
            document.getElementById('editProfileModal').style.display = 'none';
        }
    </script>
</body>
</html>


